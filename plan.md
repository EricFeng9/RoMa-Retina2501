我现在在做一个课题，目标是目标是基于我们已有的生成数据集（结构完全相同且对齐的cf-oct-fa图像对）训练出一个支持cf-fa，cf-oct（cf均为fix）的多模态配准模型。我们目前在用fractMorph模型进行2D化改造后的模型，但是fractMorph2D只能针对一些微小血管形变进行对齐和修复，但是针对真实情况不对齐图像中出现的血管大尺度旋转（如15 30度的旋转角度）、大的位置偏移的情况下配准效果较差，1是原先的逐像素点移动的模式很差2是我们修改成让模型直接预测放射参数，效果也很差，几乎不收敛。我现在的想法是改造 RoMa (Robust Dense Feature Matching)，学习cf图像和oct/fa图像之间的关键点匹配，然后利用这些匹配出来的关键点计算放射矩阵，对跨模态图像进行配准。RoMa 在处理极端变化（如大尺度旋转、光照突变和不同模态纹理差异）上比 LoFTR 更具鲁棒性。其核心优势在于结合了冻结的基础模型特征(DINOv2)的全局鲁棒性和专门的 ConvNet 的精细定位能力。

@data/CF_260116_expand 数据集每一个文件夹下面是一组多模态数据集，格式为[编号]_[模态]_[其他备注].png。配准模式共有cffa（cf为fix），cfoct（cf为fix），octfa（oct为fix），cfocta（cf为fix）四种模式。_cf_clip_512(或者_cf_gen_clip_512)和_octa_gen用于cfocta配准的训练，剩下的_cf_512(_cf_gen_512)、_fa(_fa_gen)、_oct(_oct_gen)分别用于对应的cffa和cfoct和faoct配准。

**重要更新：** 每个数据集文件夹现在包含一张血管分割掩码图（格式如 [编号]_vessel_mask.png），用于表示该组数据中所有模态（CF/OCT/FA/CFCLIP/OCTA）共同的血管结构。该掩码将用于引导模型关注血管区域，屏蔽背景、病灶等非血管结构的干扰。由@data/CF_260116_expand/cf_260116_expand.py 根据需要返回给训练和测试脚本

为了实现基于 RoMa 的眼底图像跨模态配准，你需要将原有的"基于变形场"或"直接参数回归"的思路转变为"**基于特征匹配的几何解算**"思路。以下是为您定制的 RoMa 改造方案：**解剖特征驱动的鲁棒稠密配准**。

以下是为您整理的详细实现与训练计划，包含核心公式与步骤：

---

## 核心架构改造：从"通用匹配"到"解剖引导"

RoMa 采用粗到精(Coarse-to-Fine)的架构。我们将引入您的血管分割掩码 $M^{vessel}$ 来增强其对眼底解剖结构的感知。

通过引入血管分割掩码 $M^{vessel}$，改进后的 RoMa 模型采用以下**解剖引导**策略：

1.  **模态对齐与特征提取：** RoMa 默认使用冻结的 DINOv2 获取粗特征。由于眼底图(CF、OCT、FA)与自然图像存在领域差异，需进行模态对齐。在 DINOv2 前添加轻量级的 Modality Adapter，将不同模态映射到 DINOv2 熟悉的特征空间。
2.  **血管增强融合：** 将下采样的 $M^{vessel}$ 与图像特征在通道维度拼接或作为特征偏移量引入，增强模型对血管结构的感知。
3.  **注意力解耦与偏置 (Anatomical Biasing)：** Transformer 注意力机制采用**加性偏置 (Additive Bias)**，引入血管权重矩阵 $W_{pair}$，强制 Transformer 优先关注血管交叉点和分叉点，这些区域在跨模态中具有最高的拓扑一致性。
4.  **损失监督与梯度保底 (Loss Weighting)：** 损失函数给背景区域预留 0.1 的"低保"权重（梯度保底），确保即使匹配点落在背景上，也能产生微弱梯度推动模型学习大尺度的旋转信息。
5.  **空间分布约束：** 在 RANSAC 前进行空间均匀化 (Spatial Binning)，将图像划分为 8×8 个分区，每个分区只选取置信度最高的 N 个点对，确保匹配点遍布全图，提高放射变换矩阵的稳定性。

---

## 第一阶段：模型架构改造 (Architecture)

RoMa 的核心是结合冻结的 DINOv2 特征和专门的 ConvNet，通过 Transformer 建立稠密特征匹配。

### 1. 模态适配器与双流特征提取 (Backbone)

RoMa 默认使用冻结的 DINOv2 获取粗特征。由于眼底图(CF、OCT、FA)与自然图像存在领域差异，需进行模态对齐。

#### 粗特征编码器 $F_{coarse}$：

* **基础：** 冻结的 DINOv2 (ViT-L/14)
* **改造：** 在 DINOv2 前添加一个轻量级的 Modality Adapter（如 3×3 卷积层），将不同模态映射到 DINOv2 熟悉的特征空间
* **血管增强：** 将下采样的 $M^{vessel}$ 与图像特征在通道维度拼接或作为特征偏移量引入

#### 精特征编码器 $F_{fine}$：

* **选择：** 采用专门的 VGG19。RoMa 的实验证明，VGG19 在精细定位任务中显著优于 ResNet

* **输入：** 图像对 $I^A$ (固定图 CF) 和 $I^B$ (待配准图 OCT/FA)，以及对应的血管分割掩码 $M^{vessel}$。
* **输出：** 提取两层特征。
* **粗级特征：** $\tilde{F} \in \mathbb{R}^{\frac{H}{8} \times \frac{W}{8} \times D}$，用于全局匹配。
* **精级特征：** $\hat{F} \in \mathbb{R}^{\frac{H}{2} \times \frac{W}{2} \times d}$，用于亚像素微调。

* **解剖掩码融合策略：**
* **关键原则：** 血管掩码信息通过通道拼接或特征偏移量引入，保留全局感知能力，有助于 Transformer 建立正确的全局位置编码。





### 2. 掩码引导的 Transformer 匹配解码器 (Match Decoder)

RoMa 的解码器通过预测**锚点概率 (Anchor Probabilities)** 来实现回归。

#### 锚点离散化：

我们将配准空间离散化为 $K = 64 \times 64$ 个锚点。定义匹配条件分布：

$$P_{coarse}(x^B | x^A) = \sum_{k=1}^K \pi_k(x^A) B_{m_k}$$

其中 $\pi_k$ 是概率，$B$ 是均匀分布，$\{m_k\}$ 是网格锚点。

#### 解剖偏置注入 (Anatomical Biasing)：

在 Transformer 的注意力计算中，引入血管权重矩阵 $W_{pair}$：

$$S_{biased}(i, j) = S(i, j) + \lambda \cdot (M^A(i) \cdot M^B(j_{trans}))$$

* **物理意义：** 强制 Transformer 优先关注血管交叉点和分叉点，这些区域在跨模态中具有最高的拓扑一致性。
* **加性偏置的优势：** 允许非血管区域保留微弱的响应，保证了梯度的连续性；引导注意力机制向血管区域倾斜，而不是直接关闭非血管通道。

这种方式让 $I^A$ 的每一个像素都能在"血管及其邻域"的范围内感知 $I^B$ 的全局血管拓扑结构：既能处理大尺度旋转（±90°），又避免了纯背景噪声主导几何估计。

---

## 第二阶段：训练数据生成 (GT Label Generation)

利用你现有的**已对齐生成数据集**，你可以自动生成完美的训练标签 。

### 1. 模拟放射变换

在训练时，随机生成一个放射变换矩阵 $T$（包含 $\pm 90^\circ$ 的旋转、平移和缩放），并作用于 $I^B$ 得到 $I_{warped}^B$。

**增强策略：**
* **旋转：** 均匀采样 $[-90^\circ, 90^\circ]$ 范围内的角度，覆盖极大角度旋转情况
* **翻转：** 随机加入水平/垂直翻转，模拟不同采集方向
  * 水平翻转概率：随机应用
  * 垂直翻转概率：随机应用
  * 翻转与旋转可组合使用
* **全局感知：** 由于 DINOv2 提取的是语义级别的特征，即便血管旋转 90°，其局部的拓扑结构特征在 DINO 空间中依然保持高度相似

### 2. 建立坐标映射 (Ground Truth with Vessel Constraint)

对于 $I^A$ 中的任意像素点 $i = (x, y)$，其对应的真值点 $j_{gt}$ 在 $I_{warped}^B$ 中的位置为：
$$j_{gt} = T \cdot [x, y, 1]^T$$

**引入血管掩码的GT筛选：**
* **粗级标签 $\mathcal{M}_c^{gt}$：** 若两个 1/8 网格中心点满足以下条件，则标记为正样本对：
  1. 重投影距离小于阈值（如 1 个网格单位）
  2. **$\tilde{M}^A(i) = 1$ 且 $\tilde{M}^B(j_{gt}) = 1$（两点均在血管区域内）**
* **精级标签 $\mathcal{M}_f^{gt}$：** 直接使用 $j_{gt}$ 作为 $L_2$ 损失的目标坐标，同样需满足掩码约束。

**作用：** 通过掩码筛选，训练数据只包含血管区域的匹配点对，模型从一开始就学习忽略非血管结构，避免在病灶、视盘等区域产生误匹配 。

---

## 第三阶段：损失函数设计 (Supervision)

训练损失函数：回归与分类的结合

RoMa 提出了一种改进的损失公式：全局匹配阶段建模多模态分布（回归转分类），细化阶段建模单模态分布（鲁棒回归）。

### 1. 粗级损失 $\mathcal{L}_{coarse}$ (Regression-by-classification)

利用您的对齐数据集，通过模拟放射变换 $T$ 生成真值坐标 $x_{gt}^B$。使用 KL 散度最小化预测分布与真值锚点分布的差异：

$$\mathcal{L}_{coarse} = -\frac{1}{|\mathcal{M}|} \sum_{(i,j) \in \mathcal{M}} \max(W_{vessel}, \varepsilon) \cdot \log P_c(\tilde{i}, \tilde{j})$$

其中：
* $\mathcal{M}$ 是匹配点对集合
* $W_{vessel}$ 是血管权重
* $\varepsilon = 0.1$ 是梯度保底阈值
* $P_c(\tilde{i}, \tilde{j})$ 是预测的锚点概率分布

**梯度保底 (Gradient Guard)：**
* 即使是非血管区域，也保留 $\varepsilon=0.1$ 的权重，确保模型能学习全图的大尺度旋转信息。
* **物理意义：** 即使点对落在背景上，也会产生微弱的梯度推动模型学习大尺度的几何变换。血管区域的高权重则负责后期的精细对齐。

### 2. 精级细化损失 $\mathcal{L}_{fine}$ (Robust Regression)

在细化阶段，RoMa 使用广义 Charbonnier 损失，其梯度在局部类似 L2，但在全局趋于零，能有效抑制异常值：

$$\mathcal{L}_{fine} \propto (||W(x^A) - x_{gt}^B||^2 + s)^{1/4}$$

其中：
* $W(x^A)$ 是变换后的坐标
* $x_{gt}^B$ 是真值坐标
* $s$ 是平滑参数

**优势：** 相比 L2 损失，Charbonnier 损失对异常值更加鲁棒，适合处理跨模态匹配中的噪声和误匹配。

---

## 针对眼底配准的专项策略

### 1. 极大尺度旋转应对 (±90° Support)

* **训练增强：** 将旋转采样范围扩大至 $[-90°, 90°]$，并随机加入水平/垂直翻转。
* **全局感知：** 由于 DINOv2 提取的是语义级别的特征，即便血管旋转 90°，其局部的拓扑结构特征在 DINO 空间中依然保持高度相似。RoMa 的 Transformer 解码器在不使用位置编码的情况下非常健壮。

### 2. 空间均匀化采样 (Spatial Binning for RANSAC)

* **问题：** RoMa 生成的是稠密变形场，直接解算矩阵容易受主血管区域干扰。
* **操作：** 从 RoMa 的稠密输出中，基于置信度 $p(x^A)$ 进行采样。
* **网格约束：** 在图像的 $8 \times 8$ 个分区中，每个分区只选取置信度最高的 N 个点对，确保匹配点遍布全图，提高放射变换矩阵 $M$ 的稳定性。

---

## 第四阶段：训练策略：解剖课程学习 (Curriculum Learning)

让模型先学“简单的全图对齐”，再学“难的血管对齐”。

* **阶段 1 (前 20% Epochs)：全图感知期**
  - 不使用血管掩码，或者令 $W_{pair}$ 全为 1。
  - 让模型先利用全图信息学会处理 $\pm 90^\circ$ 的旋转和大尺度偏移。
* **阶段 2 (中间 50% Epochs)：软掩码引导期**
  - 引入软掩码加性偏置，设置背景权重（Background Weight）为 0.2。
  - 模型开始向血管聚焦，但在非血管区域保留梯度。
* **阶段 3 (最后 30% Epochs)：精度冲刺期**
  - 强化血管权重，将背景权重降至 0.05 或使用硬掩码。
  - 进行最后的精度对齐冲刺。

---

## 第五阶段：配准解算 (Inference & Registration)

模型训练完成后，配准不再是预测变形场，而是解算矩阵：

1. **特征匹配（带掩码过滤）：** 
   * 输入未对齐的 $I^A, I^B$ 及其血管掩码 $M^{vessel}_A, M^{vessel}_B$。
   * LoFTR 输出点对集合 $\{(x_k, y_k) \leftrightarrow (x'_k, y'_k)\}$。
   * **掩码过滤：** 剔除所有不在血管区域内的匹配点，即保留满足 $M^{vessel}_A(x_k, y_k) = 1$ 且 $M^{vessel}_B(x'_k, y'_k) = 1$ 的点对。

2. **RANSAC 空间分布约束 (Spatial Binning for RANSAC)：**
   * RoMa 生成的是稠密变形场，直接解算矩阵容易受主血管区域干扰。
   * **操作：** 从 RoMa 的稠密输出中，基于置信度 $p(x^A)$ 进行采样。
   * **网格约束：** 在图像的 $8 \times 8$ 个分区中，每个分区只选取置信度最高的 N 个点对，确保匹配点遍布全图，提高放射变换矩阵 $M$ 的稳定性。
   * **理由：** 强制匹配点在空间上散开，能极大提高放射变换矩阵求解的稳定性，防止模型退化为单位矩阵 $I$。
   * 使用 **RANSAC** 算法剔除误匹配，并求解放射矩阵 $M$ ：
$$\min_M \sum_k ||M \cdot [x_k, y_k, 1]^T - [x'_k, y'_k, 1]^T||^2$$

3. **大尺度转换处理：** 由于加入了血管结构约束，模型即使在极大旋转角度（±90°）下仍可以依靠血管拓扑对应关系建立准确匹配。RoMa 的 Transformer 解码器在不使用位置编码的情况下非常健壮，能够处理极大尺度的旋转。

4. **重采样：** 利用 $M$ 对 $I^B$ 进行 Warp，完成配准。

---

## 第五阶段：数据增强与掩码一致性保证 (Data Augmentation)

在训练过程中，对图像进行放射变换的同时，**必须对血管掩码进行相同的几何变换**，以保证掩码与变换后的图像对齐。

### 增强策略

1. **同步放射变换：**
   * 生成随机放射矩阵 $T$（旋转 $\pm 90^\circ$，平移 $\pm 20\%$，缩放 $0.8 \sim 1.2$）
   * **随机翻转：** 随机加入水平/垂直翻转（可与旋转组合）
   * 同时对 $I^B$ 和 $M^{vessel}_B$ 应用相同的变换得到 $I^B_{warped}$ 和 $M^{vessel}_{B,warped}$
   * **插值方法：** 图像使用双线性插值，掩码使用最近邻插值（保持二值性）

2. **血管结构保持增强：**
   * 亮度、对比度调整（仅影响图像，不影响掩码）
   * 轻微高斯噪声（$\sigma < 0.02$，避免破坏血管边缘）
   * **禁止使用：** Elastic Deformation（会破坏掩码与图像的几何对应关系）

3. **掩码质量保证：**
   * 若变换后掩码面积减少超过 30%（边界裁剪），则重新采样该样本
   * 使用形态学操作（开运算）清除掩码中的孤立噪点

---

## 第六阶段：实现细节与模块设计 (Implementation Details)

### 数据加载器修改 (DataLoader)

在 `cf_260116_expand.py` 中添加掩码返回逻辑：

```python
def __getitem__(self, idx):
    # 原有逻辑：加载 I^A, I^B
    img_A = load_image(self.cf_paths[idx])
    img_B = load_image(self.oct_fa_paths[idx])
    
    # 新增：加载血管掩码
    mask_vessel = load_mask(self.vessel_mask_paths[idx])  # 二值图，0/1 或 0/255
    mask_vessel = (mask_vessel > 0.5).astype(np.float32)  # 归一化为 0/1
    
    # 生成随机放射变换（旋转范围扩大到 ±90°）
    T = generate_random_affine(rotation=(-90, 90), translation=(-0.2, 0.2), scale=(0.8, 1.2))
    
    # 随机翻转
    flip_h = np.random.rand() < 0.5  # 随机水平翻转
    flip_v = np.random.rand() < 0.5  # 随机垂直翻转
    
    # 同步变换图像和掩码
    img_B_warped = cv2.warpAffine(img_B, T[:2], (W, H), flags=cv2.INTER_LINEAR)
    mask_B_warped = cv2.warpAffine(mask_vessel, T[:2], (W, H), flags=cv2.INTER_NEAREST)
    
    # 应用翻转（图像和掩码同步）
    if flip_h:
        img_B_warped = cv2.flip(img_B_warped, 1)  # 水平翻转
        mask_B_warped = cv2.flip(mask_B_warped, 1)
    if flip_v:
        img_B_warped = cv2.flip(img_B_warped, 0)  # 垂直翻转
        mask_B_warped = cv2.flip(mask_B_warped, 0)
    
    return {
        'image0': img_A,
        'image1': img_B_warped,
        'mask0': mask_vessel,      # CF 的掩码（原始）
        'mask1': mask_B_warped,    # OCT/FA 的掩码（变换后）
        'T_0to1': T,               # 真值变换矩阵
        'flip_h': flip_h,          # 是否水平翻转
        'flip_v': flip_v           # 是否垂直翻转
    }
```

### RoMa 模型修改要点

1. **Backbone 输出修改：**
   * **粗特征编码器：** 在冻结的 DINOv2 (ViT-L/14) 前添加 Modality Adapter（3×3 卷积层）
   * 将血管掩码下采样并与图像特征在通道维度拼接或作为特征偏移量引入
   * **精特征编码器：** 使用 VGG19 作为精细定位网络

2. **Transformer 匹配解码器修改：**
   * 实现锚点概率预测（64×64 个锚点）
   * **解剖偏置实现：**
   ```python
   # 相似度计算 (Anatomical Biasing)
   sim_matrix = compute_attention(Q, K, V)  # RoMa 的注意力计算
   if use_vessel_bias:
       # 加性偏置引导，不截断梯度
       vessel_bias = lambda_weight * (M_vessel_A.unsqueeze(-1) * M_vessel_B.unsqueeze(-2))
       sim_matrix = sim_matrix + vessel_bias
   ```

3. **损失函数修改：**
   * **粗级损失（KL 散度）：**
   ```python
   # 锚点概率分布与真值分布的 KL 散度
   anchor_probs = model.predict_anchor_probs(feat_A, feat_B)
   gt_anchor_dist = create_gt_anchor_distribution(x_gt_B, K=64*64)
   loss_coarse = F.kl_div(F.log_softmax(anchor_probs, dim=-1), gt_anchor_dist, reduction='none')
   # 梯度保底：给背景留 0.1 的权重
   loss_weight = torch.clamp(W_vessel, min=0.1)
   loss_coarse = (loss_coarse * loss_weight).mean()
   ```
   * **精级损失（Charbonnier）：**
   ```python
   # 广义 Charbonnier 损失
   diff = W(x_A) - x_gt_B
   loss_fine = ((diff ** 2 + s) ** 0.25).mean()
   ```

### 训练超参数建议

| 参数 | 值 | 说明 |
|------|-----|------|
| 学习率 | 8e-4 | AdamW 优化器，带 Cosine 衰减 |
| Batch Size | 4-8 | 取决于 GPU 显存（512×512 图像） |
| 训练轮数 | 100-200 epochs | 监控验证集匹配精度 |
| 粗级阈值 | 1.0 (网格单位) | 1/8 分辨率下的距离阈值 |
| 精级窗口 | $w = 5$ | 5×5 像素窗口 |
| 血管权重 | $\alpha=2, \beta=0.1$ | 特征加权参数 |
| 边缘点权重 | 1.5 | 血管边缘关键点的损失权重 |

---

## 修改总结：引入血管掩码后的完整流程

### 数据流 (Data Pipeline)

1. **输入：** 
   - 固定图 $I^A$ (CF)
   - 待配准图 $I^B$ (OCT/FA)
   - 血管分割掩码 $M^{vessel}$（二值图，表示所有模态共同的血管结构）

2. **数据增强：**
   - 对 $I^B$ 和 $M^{vessel}$ 同步应用随机放射变换 $T$
   - 掩码使用最近邻插值保持二值性
   - 筛选掉掩码面积损失过大的样本

3. **特征提取：**
   - 双流 Backbone 提取粗/精两级特征
   - 掩码下采样到 1/8 和 1/2 分辨率
   - 通过加权或拼接方式融合掩码信息到特征

4. **掩码化注意力：**
   - 在 Transformer 的相似度矩阵上应用掩码
   - 仅允许血管区域之间建立匹配关系
   - 非血管区域相似度设为 $-\infty$

5. **损失计算：**
   - **粗级：** 仅在血管区域的GT点对上计算损失，血管边缘点权重更高
   - **精级：** 检查窗口内血管占比，过滤低质量窗口，亚像素计算仅考虑血管像素

6. **推理与配准：**
   - 输入待配准图像对及其掩码
   - RoMa 输出稠密变形场和匹配点对
   - 基于置信度进行空间均匀化采样（8×8 分区）
   - 掩码过滤非血管匹配点
   - RANSAC 求解放射矩阵
   - 应用变换完成配准

### 关键创新点

| 模块 | 原始 RoMa | 引入掩码后的改进 |
|------|-----------|----------------|
| **输入** | 仅图像对 | 图像对 + 血管掩码 |
| **粗特征编码器** | 冻结 DINOv2 | **DINOv2 + Modality Adapter + 血管增强** |
| **精特征编码器** | VGG19 | VGG19（保持不变） |
| **匹配解码器** | 锚点概率预测 | **掩码引导的锚点概率预测** |
| **注意力机制** | 全局无约束匹配 | **解剖偏置 (+λ·W_pair)**，软性引导 |
| **损失函数** | KL 散度 + Charbonnier | **梯度保底 (min=0.1)**，保证早期收敛 |
| **训练策略** | 单一阶段 | **课程学习**，从全图对齐到血管精对齐 |
| **RANSAC** | 均匀采样 | **空间均匀化 (8×8 Binning)**，防退化 |
| **旋转支持** | 有限角度 | **±90° 支持**，极大尺度旋转 |

### 预期效果

通过引入"解剖引导"策略，模型将能够：

1. **处理极大角度旋转（±90°）和翻转：** RoMa 的 Transformer 解码器在不使用位置编码的情况下非常健壮。由于 DINOv2 提取的是语义级别的特征，即便血管旋转 90°，其局部的拓扑结构特征在 DINO 空间中依然保持高度相似。
2. **处理大位置偏移：** 即使点对落在背景上，微弱的梯度保底（ε=0.1）也能推动模型学习大尺度的旋转信息。
3. **避免模型退化：** 空间均匀化 (8×8 Spatial Binning) 强制匹配点散开，防止解算的放射矩阵退化为单位矩阵 $I$。
4. **提升关键点质量：** 通过解剖偏置引导注意力向血管交叉点和分叉点倾斜，这些区域在跨模态中具有最高的拓扑一致性。
5. **加速收敛：** 课程学习从易到难，降低了大尺度搜索空间的学习难度。
6. **解决 LoFTR 无法处理的问题：** 能够处理 30° 以上大旋转问题，甚至支持 ±90° 的极大尺度旋转。

---

## 实施阶段建议 (Roadmap)

### 第一阶段：Backbone 适配
* **核心任务：** 冻结 DINOv2，添加 Modality Adapter，使用 VGG19 作为精细层。
* **预期目标：** 消除 CF 与 OCT/FA 的纹理鸿沟。

### 第二阶段：解剖引导训练
* **核心任务：** 引入 $M^{vessel}$ 加性偏置和分类损失 $\mathcal{L}_{coarse}$。
* **预期目标：** 实现对血管分叉点的强力锁定。

### 第三阶段：鲁棒性强化
* **核心任务：** 全量放射变换增强（旋转、翻转、缩放），旋转范围扩大到 ±90°。
* **预期目标：** 解决 LoFTR 无法处理的 30° 以上大旋转问题。

### 第四阶段：矩阵解算
* **核心任务：** 稠密 Warp → 空间均匀采样（8×8 分区）→ RANSAC。
* **预期目标：** 输出最终的放射变换矩阵 $M$。

